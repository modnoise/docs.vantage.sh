"use strict";(self.webpackChunkdocs_vantage_sh=self.webpackChunkdocs_vantage_sh||[]).push([[5136],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},f=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,s=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=l(n),f=a,h=p["".concat(c,".").concat(f)]||p[f]||d[f]||s;return n?r.createElement(h,o(o({ref:t},u),{},{components:n})):r.createElement(h,o({ref:t},u))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var s=n.length,o=new Array(s);o[0]=f;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[p]="string"==typeof e?e:a,o[1]=i;for(var l=2;l<s;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}f.displayName="MDXCreateElement"},4953:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var r=n(7462),a=(n(7294),n(3905));const s={id:"kubernetes",title:"Kubernetes Costs",description:"Kubernetes cost reporting and efficiency metrics documentation for Vantage including costs by cluster, namespace, and label as well as idle costs and pod efficiency metrics.",keywords:["Kubernetes","Kubernetes costs","Kubernetes efficiency metrics"]},o="Kubernetes Costs and Efficiency Metrics",i={unversionedId:"kubernetes",id:"kubernetes",title:"Kubernetes Costs",description:"Kubernetes cost reporting and efficiency metrics documentation for Vantage including costs by cluster, namespace, and label as well as idle costs and pod efficiency metrics.",source:"@site/docs/kubernetes.md",sourceDirName:".",slug:"/kubernetes",permalink:"/kubernetes",draft:!1,editUrl:"https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/kubernetes.md",tags:[],version:"current",frontMatter:{id:"kubernetes",title:"Kubernetes Costs",description:"Kubernetes cost reporting and efficiency metrics documentation for Vantage including costs by cluster, namespace, and label as well as idle costs and pod efficiency metrics.",keywords:["Kubernetes","Kubernetes costs","Kubernetes efficiency metrics"]},sidebar:"someSidebar",previous:{title:"Kubernetes (Container Insights)",permalink:"/kubernetes_container_insights"},next:{title:"Datadog",permalink:"/connecting_datadog"}},c={},l=[{value:"Kubernetes Cost Reports",id:"kubernetes-cost-reports",level:2},{value:"Kubernetes Efficiency Metrics",id:"kubernetes-efficiency-metrics",level:2},{value:"Efficiency Calculations",id:"efficiency-calculations",level:3},{value:"Integration Methods",id:"integration-methods",level:2}],u={toc:l},p="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(p,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"kubernetes-costs-and-efficiency-metrics"},"Kubernetes Costs and Efficiency Metrics"),(0,a.kt)("p",null,"Vantage has two sets of tools for viewing and optimizing Kubernetes costs: viewing Kubernetes costs in ",(0,a.kt)("a",{parentName:"p",href:"/cost_reports"},"Cost Reports")," and viewing Kubernetes efficiency metrics in the devoted ",(0,a.kt)("a",{parentName:"p",href:"https://console.vantage.sh/kubernetes"},"Kubernetes page")," in the console. "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Kubernetes Cost Reports")," are most useful to drill into costs by Cluster, Namespace, Service, and Label as well as combine Kubernetes costs with other providers, such as a database or cache layer. "),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Kubernetes Efficiency Metrics")," display the cost efficiency down to the pod level of a cluster and are useful for rightsizing and cost optimization.")),(0,a.kt)("h2",{id:"kubernetes-cost-reports"},"Kubernetes Cost Reports"),(0,a.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,a.kt)("img",{alt:"Resource Reports",width:"80%",src:"/img/vantage-kubernetes-reporting.png"})),(0,a.kt)("p",null,"Kubernetes Cost Reports have cost visibility by Cluster, Label, Namespace, and Service. They include Kubernetes-specific filters and filter logic. This allows you to combine specific Kubernetes costs with other services. For example, a customer can see the costs of a specific service with corresponding RDS database costs."),(0,a.kt)("p",null,"Cost Reports also include forecasts, which define Kubernetes-specific filters that will receive end-of-month forecasts. These forecasts are updated daily and give you confidence intervals of where your costs are likely to end up for the month."),(0,a.kt)("p",null,"The costs displayed on these reports come from the ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes_agent"},"Vantage Kubernetes agent"),". The agent calculates the cost of a running pod by looking at the CPU, RAM, GPU, and storage usage and calculates the cost of each based on the cost of the underlying infrastructure. There is a formula for dividing the cost of a compute instance into CPU, RAM and GPU which then computes the cost per hour of each type of resource. The agent does all the cost allocation calculations locally to your cluster and makes this data available for querying."),(0,a.kt)("p",null,"Kubernetes costs are not included in monthly tracked infrastructure costs as they\u2019re already captured from underlying EKS, GKE, or AKS costs."),(0,a.kt)("h2",{id:"kubernetes-efficiency-metrics"},"Kubernetes Efficiency Metrics"),(0,a.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,a.kt)("img",{alt:"Resource Reports",width:"80%",src:"/img/k8s-efficiency.png"})),(0,a.kt)("p",null,"Navigate to the ",(0,a.kt)("a",{parentName:"p",href:"https://console.vantage.sh/kubernetes"},"Kubernetes portion")," of the Vantage console to view Kubernetes costs and efficiency metrics. On the left navigation menu, select an option to view connected Clusters, Namespaces, and Labels. Each view contains a graph as well as a table with the following headings:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Name"),". The name of the Cluster, Namespace, or Label you\u2019re viewing."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Idle Costs"),". A dollar value representation of the amount of resources requested that are idle."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Total Costs"),". A dollar value representation of the total cost of resources."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("strong",{parentName:"li"},"Cost Efficiency"),". The percent ratio of idle costs and total costs.")),(0,a.kt)("p",null,"You can filter efficiency metrics for a cluster using a few different options:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Change the date range to see how they have changed over time. Select the date options on the top right of the chart. "),(0,a.kt)("li",{parentName:"ul"},"Change the aggregation to see the metrics by Cluster, Namespace, or Label. From the resource list below each chart, click the icons next to each resource to view different aggregations. ")),(0,a.kt)("h3",{id:"efficiency-calculations"},"Efficiency Calculations"),(0,a.kt)("p",null,"Pod resource efficiency is defined as the resource utilization versus the resource request over a given time window. These resource utilization metrics include CPU and RAM. When viewing efficiency, it will be shown as a percentage. 100% means the resource allocation is fully efficient."),(0,a.kt)("p",null,"Idle costs are defined as the difference between the cost of requested resources (CPU and Memory) and the associated usage of those costs:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"idle_cost = (cpu_request_cost - cpu_usage_cost) +\n            (memory_request_cost - memory_usage_cost)\n")),(0,a.kt)("p",null,"Efficiency metrics are available immediately after your OpenCost metrics are imported, generally once per day. For more information on how container costs are allocated for OpenCost integrations, see the ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/opencost/opencost/blob/develop/spec/opencost-specv01.md"},"OpenCost specification"),"."),(0,a.kt)("h2",{id:"integration-methods"},"Integration Methods"),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"Vantage recommends integrating with the ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes_agent"},"Vantage Kubernetes Agent")," to utilize the most granular reporting features and the cost-efficiency metrics. ")),(0,a.kt)("p",null,"For the Vantage Kubernetes Agent, costs are exported from the cluster hourly and then made available nightly. It's important to note that these costs might encounter delays based on their associated cloud integration's cost data. For instance, if there is a one-day delay in an AWS Cost and Usage Report, the clusters dependent on that data will experience a similar delay."),(0,a.kt)("p",null,"For OpenCost integrations, while we work to upstream the efficiency metrics into the main OpenCost project, you can deploy the Vantage-maintained OpenCost branch via ",(0,a.kt)("a",{parentName:"p",href:"https://quay.io/repository/vantage-sh/opencost?tab=tags&tag=latest"},"the repository"),"."),(0,a.kt)("p",null,"Efficiency metrics will be available up to 24 hours after updating your clusters. For OpenCost users, you can query the Amazon Managed Prometheus associated with your integration for ",(0,a.kt)("inlineCode",{parentName:"p"},"count(container_cpu_idle) by (cluster_id)")," to verify the metrics are making it from your Kubernetes cluster to the Prometheus that Vantage will use to gather them periodically."),(0,a.kt)("p",null,"In most cases, Prometheus running on a Kubernetes cluster will not be exposed with a public endpoint. To get around this a second centralized Prometheus instance is deployed into your account to be used as an aggregation point which Vantage has both network and IAM access to query. Vantage can integrate with any publicly accessible Prometheus endpoint\u2014including Grafana cloud."),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"For Google Cloud, Azure, and on-premises support for Kubernetes efficiency metrics, please contact us at ",(0,a.kt)("a",{parentName:"p",href:"mailto:support@vantage.sh"},"support@vantage.sh"),".")))}d.isMDXComponent=!0}}]);