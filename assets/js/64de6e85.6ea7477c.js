"use strict";(self.webpackChunkdocs_vantage_sh=self.webpackChunkdocs_vantage_sh||[]).push([[800],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},p="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=s(n),d=r,m=p["".concat(c,".").concat(d)]||p[d]||g[d]||o;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l[p]="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4145:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var a=n(7462),r=(n(7294),n(3905));const o={},i="Setup Google Cloud",l={unversionedId:"connecting_gcp",id:"connecting_gcp",title:"Setup Google Cloud",description:"Connecting Your GCP Billing Account",source:"@site/docs/connecting_gcp.md",sourceDirName:".",slug:"/connecting_gcp",permalink:"/connecting_gcp",draft:!1,editUrl:"https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/connecting_gcp.md",tags:[],version:"current",frontMatter:{},sidebar:"someSidebar",previous:{title:"Azure",permalink:"/connecting_azure"},next:{title:"GCP Permissions",permalink:"/permissions_gcp"}},c={},s=[{value:"Connecting Your GCP Billing Account",id:"connecting-your-gcp-billing-account",level:2},{value:"Read-Only by Default",id:"read-only-by-default",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Creating a GCP Data Integration",id:"creating-a-gcp-data-integration",level:2},{value:"Connecting Manually",id:"connecting-manually",level:2},{value:"Assign Vantage Service Account Permission to Access BigQuery",id:"assign-vantage-service-account-permission-to-access-bigquery",level:3},{value:"Assign Vantage Service Account Permission to Access BigQuery Dataset",id:"assign-vantage-service-account-permission-to-access-bigquery-dataset",level:3},{value:"Connecting with Terraform",id:"connecting-with-terraform",level:2}],u={toc:s},p="wrapper";function g(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"setup-google-cloud"},"Setup Google Cloud"),(0,r.kt)("h2",{id:"connecting-your-gcp-billing-account"},"Connecting Your GCP Billing Account"),(0,r.kt)("p",null,"Vantage integrates with your GCP account through the use of a ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.google.com/iam/docs/service-accounts"},"service account"),". A service account is generated on a per customer basis and is only granted permissions to read from the specific Big Query table in your account."),(0,r.kt)("h2",{id:"read-only-by-default"},"Read-Only by Default"),(0,r.kt)("p",null,"The service account is read-only by default. It does not have permissions nor will ever attempt to make any changes to your infrastructure."),(0,r.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("p",null,"Before you begin, you will need to:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Enable Billing Export"),(0,r.kt)("li",{parentName:"ol"},"Create a project to store your Billing Export data"),(0,r.kt)("li",{parentName:"ol"},"Create a BigQuery dataset to store your Billing Export data")),(0,r.kt)("p",null,"If you have a pre-existing Billing Export, double-check the requirements below then skip to the ",(0,r.kt)("a",{parentName:"p",href:"/connecting_gcp/#creating-a-gcp-data-integration"},"next section"),". If you need help setting up Billing Export, you can follow the instruction ",(0,r.kt)("a",{parentName:"p",href:"/enabling_gcp_billing_export/"},"here"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Billing Export Requirements:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Project is linked to the same Cloud Billing account that Billing Export is enabled on"),(0,r.kt)("li",{parentName:"ul"},"Detailed Billing Export is enabled, not Standard Billing Export"),(0,r.kt)("li",{parentName:"ul"},"The BigQuery dataset and table is deployed to either ",(0,r.kt)("inlineCode",{parentName:"li"},"us (multiple regions in United States)")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"eu (multiple regions in European Union)")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Note: If you have multiple Cloud Billing accounts, you will need to enable Cloud Billing Export on each one individually."))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Recommendation:")," We recommend that you create a dedicated project to store all Cloud Billing data rather than using an existing project."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Note on Currency:")," If your GCP billing data is normally displayed in a currency other than USD, we will convert it to USD using the ",(0,r.kt)("inlineCode",{parentName:"p"},"currency_conversion_rate")," field in the Billing Export data."),(0,r.kt)("h2",{id:"creating-a-gcp-data-integration"},"Creating a GCP Data Integration"),(0,r.kt)("p",null,"Now that you have:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"The Billing account ID"),(0,r.kt)("li",{parentName:"ol"},"The name of the project"),(0,r.kt)("li",{parentName:"ol"},"The name of the Big Query dataset")),(0,r.kt)("p",null,"Create a GCP data integration by logging into your Vantage account and going ",(0,r.kt)("a",{parentName:"p",href:"https://console.vantage.sh/gcp_onboarding/overview"},"here"),". You will be asked to add these inputs into the onboarding flow."),(0,r.kt)("h2",{id:"connecting-manually"},"Connecting Manually"),(0,r.kt)("h3",{id:"assign-vantage-service-account-permission-to-access-bigquery"},"Assign Vantage Service Account Permission to Access BigQuery"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Open the ",(0,r.kt)("a",{parentName:"li",href:"https://console.cloud.google.com/iam-admin/iam"},"IAM Console")),(0,r.kt)("li",{parentName:"ol"},'Select the project hosting the BigQuery dataset containing your Billing Export data from the project drop-down in the main navigation bar at top. If you don\u2019t see the project name right away, try the "ALL" tab or search for it'),(0,r.kt)("li",{parentName:"ol"},"Add a new permission to the project",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Add")," button"),(0,r.kt)("li",{parentName:"ol"},"Under ",(0,r.kt)("strong",{parentName:"li"},"New principals"),", add your Vantage service account (found in the GCP onboarding workflow in the Vantage console)"),(0,r.kt)("li",{parentName:"ol"},"Attach the role ",(0,r.kt)("inlineCode",{parentName:"li"},"BigQuery Job User")),(0,r.kt)("li",{parentName:"ol"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Save")," button")))),(0,r.kt)("h3",{id:"assign-vantage-service-account-permission-to-access-bigquery-dataset"},"Assign Vantage Service Account Permission to Access BigQuery Dataset"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"In the hamburger menu, navigate to ",(0,r.kt)("strong",{parentName:"li"},"BigQuery")," under ",(0,r.kt)("strong",{parentName:"li"},"ANALYTICS")," and select ",(0,r.kt)("strong",{parentName:"li"},"SQL Workspace")),(0,r.kt)("li",{parentName:"ol"},"Grant Vantage service account access to the BigQuery dataset:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Select the project name"),(0,r.kt)("li",{parentName:"ol"},"Select the dataset by clicking the ",(0,r.kt)("strong",{parentName:"li"},"three vertical dots")," button and selecting ",(0,r.kt)("strong",{parentName:"li"},"Open")),(0,r.kt)("li",{parentName:"ol"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Share")," button and select ",(0,r.kt)("strong",{parentName:"li"},"Permissions")),(0,r.kt)("li",{parentName:"ol"},"Under New principals, add your Vantage service account"),(0,r.kt)("li",{parentName:"ol"},"Attach the role, ",(0,r.kt)("inlineCode",{parentName:"li"},"BigQuery Data Viewer")),(0,r.kt)("li",{parentName:"ol"},"Click the ",(0,r.kt)("strong",{parentName:"li"},"Save")," button"))),(0,r.kt)("li",{parentName:"ol"},"Return to the Vantage GCP onboarding workflow and click the ",(0,r.kt)("strong",{parentName:"li"},"Next")," button")),(0,r.kt)("h2",{id:"connecting-with-terraform"},"Connecting with Terraform"),(0,r.kt)("p",null,"If you manage your infrastructure with Terraform it is very easy to connect to Vantage. During onboarding, instead of following the manual integration process, you can click on the terraform instructions which will give you the IAM Role creation snippets. This can be dropped into your Terraform codebase. Once this has been deployed you can complete the onboarding workflow."))}g.isMDXComponent=!0}}]);