"use strict";(self.webpackChunkdocs_vantage_sh=self.webpackChunkdocs_vantage_sh||[]).push([[5136],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),l=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},u=function(e){var t=l(e.components);return o.createElement(c.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},f=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=l(n),f=r,h=p["".concat(c,".").concat(f)]||p[f]||d[f]||s;return n?o.createElement(h,a(a({ref:t},u),{},{components:n})):o.createElement(h,a({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,a=new Array(s);a[0]=f;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[p]="string"==typeof e?e:r,a[1]=i;for(var l=2;l<s;l++)a[l]=n[l];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}f.displayName="MDXCreateElement"},4953:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var o=n(7462),r=(n(7294),n(3905));const s={description:"Kubernetes cost reporting and efficiency metrics documentation for Vantage including costs by cluster, namespace, and label as well as idle costs and pod efficiency metrics."},a="Kubernetes Costs",i={unversionedId:"kubernetes",id:"kubernetes",title:"Kubernetes Costs",description:"Kubernetes cost reporting and efficiency metrics documentation for Vantage including costs by cluster, namespace, and label as well as idle costs and pod efficiency metrics.",source:"@site/docs/kubernetes.md",sourceDirName:".",slug:"/kubernetes",permalink:"/kubernetes",draft:!1,editUrl:"https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/kubernetes.md",tags:[],version:"current",frontMatter:{description:"Kubernetes cost reporting and efficiency metrics documentation for Vantage including costs by cluster, namespace, and label as well as idle costs and pod efficiency metrics."},sidebar:"someSidebar",previous:{title:"Segments",permalink:"/segments"},next:{title:"Cost Report Notifications",permalink:"/reports"}},c={},l=[{value:"Kubernetes Cost Reporting",id:"kubernetes-cost-reporting",level:2},{value:"Kubernetes Efficiency Metrics",id:"kubernetes-efficiency-metrics",level:2},{value:"Efficiency Calculations",id:"efficiency-calculations",level:3},{value:"Integration Methods",id:"integration-methods",level:2},{value:"Why we Recommend OpenCost vs Container Insights",id:"why-we-recommend-opencost-vs-container-insights",level:3}],u={toc:l},p="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"kubernetes-costs"},"Kubernetes Costs"),(0,r.kt)("p",null,"Vantage has two sets of tools for viewing and optimizing Kubernetes costs. The first is Kubernetes costs reporting in ",(0,r.kt)("a",{parentName:"p",href:"/cost_reports"},"Cost Reports"),". The second is Kubernetes efficiency metrics in the devoted ",(0,r.kt)("a",{parentName:"p",href:"https://console.vantage.sh/kubernetes"},"Kubernetes")," page in the console. Kuberentes Cost Reports are most useful to drill into costs by cluster, namespace, service, and label as well as combine Kubernetes costs with other providers such as a database or cache layer. Kubernetes Efficiency Metrics display the cost efficiency down to the pod level of a cluster and are useful for rightsizing and cost optimization."),(0,r.kt)("h2",{id:"kubernetes-cost-reporting"},"Kubernetes Cost Reporting"),(0,r.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,r.kt)("img",{alt:"Resource Reports",width:"80%",src:"/img/vantage-kubernetes-reporting.png"})),(0,r.kt)("p",null,"Kuberentes Cost Reports have cost visibility by Cluster, Label, Namespace, and Service. They include Kubernetes-specific filters and filter logic. This allows you to combine specific Kubernetes costs with other services. For example, a customer can see the costs of a specific service with corresponding RDS database costs."),(0,r.kt)("p",null,"Cost reports also include forecasts which define Kubernetes specific filters will receive end-of-month forecasts. These forecasts are updated daily and give you confidence intervals of where your costs are likely to end up for the month."),(0,r.kt)("p",null,"The costs displayed on these reports come from ",(0,r.kt)("a",{parentName:"p",href:"/opencost"},"OpenCost"),". OpenCost calculates the cost of a running pod by looking at the CPU, RAM, GPU and storage usage and calculates the cost of each based on the cost of the underlying infrastructure. There is a formula for dividing the cost of a compute instance into CPU, RAM and GPU which then computes the cost per hour of each type of resource. OpenCost does all of the cost allocation calculations locally to your cluster and makes this data available for querying."),(0,r.kt)("p",null,"Kubernetes costs are not included in monthly tracked infrastructure costs as they\u2019re already captured from underlying EKS, GKE, or AKS costs."),(0,r.kt)("h2",{id:"kubernetes-efficiency-metrics"},"Kubernetes Efficiency Metrics"),(0,r.kt)("div",{style:{display:"flex",justifyContent:"center"}},(0,r.kt)("img",{alt:"Resource Reports",width:"80%",src:"/img/k8s-efficiency.png"})),(0,r.kt)("p",null,"There is a ",(0,r.kt)("a",{parentName:"p",href:"https://console.vantage.sh/kubernetes"},"Kubernetes")," portion of the Vantage console devoted to viewing Kubernetes costs and efficiency metrics. You can view connected clusters, namespaces and labels with the following information:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Name: The name of the cluster, namespace of label you\u2019re viewing."),(0,r.kt)("li",{parentName:"ul"},"Idle Cost: A dollar value representation of the amount of resources requested that are idle."),(0,r.kt)("li",{parentName:"ul"},"Total Cost: A dollar value representation of the total cost of resources."),(0,r.kt)("li",{parentName:"ul"},"Cost Efficiency %: The ratio of idle costs and total costs.")),(0,r.kt)("p",null,"When viewing efficiency metrics for a cluster you can filter them in a couple different ways:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Change the date range to see how they have changed over time"),(0,r.kt)("li",{parentName:"ul"},"Change the aggregation to see the metrics by cluster, namespace, label.")),(0,r.kt)("h3",{id:"efficiency-calculations"},"Efficiency Calculations"),(0,r.kt)("p",null,"Pod resource efficiency is defined as the resource utilization versus the resource request over a given time window. These resource utilization metrics include CPU and RAM. When viewing efficiency it will be shown as a percentage. 100% means the resource allocation is fully efficient."),(0,r.kt)("p",null,"Idle costs are defined as the difference between the cost of requested resources (CPU and Memory) and the associated usage of those costs:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"idle_cost = (cpu_request_cost - cpu_usage_cost) +\n            (memory_request_cost - memory_usage_cost)\n")),(0,r.kt)("p",null,"Efficiency metrics are available immediately after your OpenCost metrics are imported, generally once per day. For more information on how container costs are allocated, please consult the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/opencost/opencost/blob/develop/spec/opencost-specv01.md"},"OpenCost specification"),"."),(0,r.kt)("h2",{id:"integration-methods"},"Integration Methods"),(0,r.kt)("p",null,"Vantage recommends installing ",(0,r.kt)("a",{parentName:"p",href:"/opencost"},"OpenCost")," in your cluster in order to utilize our most granular reporting features and the cost efficiency metrics. While we work to upstream the efficiency metrics into the main OpenCost project, you can deploy the Vantage-maintained OpenCost branch at ",(0,r.kt)("a",{parentName:"p",href:"https://quay.io/vantage-sh/opencost:efficiency"},"quay.io/vantage-sh/opencost:efficiency"),"."),(0,r.kt)("p",null,"Efficiency metrics will be available up to 24 hours after updating your clusters. You can query the Amazon Managed Prometheus associated with your integration for ",(0,r.kt)("inlineCode",{parentName:"p"},"count(container_cpu_idle) by (cluster_id)")," to verify the metrics are making it from your Kubernetes cluster to the Prometheus that Vantage will use to gather them periodically."),(0,r.kt)("p",null,"In most cases Prometheus running on a Kubernetes cluster will not be exposed with a public endpoint. To get around this a second centralized Prometheus instance is deployed into your account to be used as an aggregation point which Vantage has both network and IAM access to query. Vantage can integrate with any publicly accessible Prometheus endpoint - including Grafana cloud."),(0,r.kt)("p",null,"For Google Cloud, Azure, and on-prem support for Kubernetes efficiency metrics, please contact us at ",(0,r.kt)("a",{parentName:"p",href:"mailto:support@vantage.sh"},"support@vantage.sh"),"."),(0,r.kt)("h3",{id:"why-we-recommend-opencost-vs-container-insights"},"Why we Recommend OpenCost vs Container Insights"),(0,r.kt)("p",null,"Container Insights stores all pod level system metrics such as CPU and RAM. From there Vantage queries CloudWatch for these metrics and does the cost allocation calculation. Container Insights is more expensive for users to run as they have to pay to store the system metrics and pay for the cost of Vantage querying these costs."))}d.isMDXComponent=!0}}]);