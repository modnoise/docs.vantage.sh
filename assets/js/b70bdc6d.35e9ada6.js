"use strict";(self.webpackChunkdocs_vantage_sh=self.webpackChunkdocs_vantage_sh||[]).push([[1009],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>g});var r=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,r,n=function(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=r.createContext({}),p=function(e){var t=r.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):s(s({},t),e)),a},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),c=p(a),m=n,g=c["".concat(l,".").concat(m)]||c[m]||d[m]||o;return a?r.createElement(g,s(s({ref:t},u),{},{components:a})):r.createElement(g,s({ref:t},u))}));function g(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,s=new Array(o);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[c]="string"==typeof e?e:n,s[1]=i;for(var p=2;p<o;p++)s[p]=a[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,a)}m.displayName="MDXCreateElement"},9379:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var r=a(7462),n=(a(7294),a(3905));const o={id:"terraform",title:"Terraform Provider",description:"Use the Vantage provider for Terraform as part of your FinOps as Code toolkit. Create Terraform cost reporting resources.",keywords:["Terraform"]},s="Terraform Provider",i={unversionedId:"terraform",id:"terraform",title:"Terraform Provider",description:"Use the Vantage provider for Terraform as part of your FinOps as Code toolkit. Create Terraform cost reporting resources.",source:"@site/docs/terraform.md",sourceDirName:".",slug:"/terraform",permalink:"/terraform",draft:!1,editUrl:"https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/terraform.md",tags:[],version:"current",frontMatter:{id:"terraform",title:"Terraform Provider",description:"Use the Vantage provider for Terraform as part of your FinOps as Code toolkit. Create Terraform cost reporting resources.",keywords:["Terraform"]},sidebar:"someSidebar",previous:{title:"API",permalink:"/api"},next:{title:"VQL (Vantage Query Language)",permalink:"/vql"}},l={},p=[{value:"Vantage Terraform Integrations Module for AWS",id:"integrations-module",level:2},{value:"Vantage Resources and Data Sources",id:"vantage-resources-and-data-sources",level:2},{value:"Terraform Examples",id:"terraform-examples",level:2},{value:"Create a Cost Report",id:"create-a-cost-report",level:3},{value:"Using Multiple Vantage Terraform Resources",id:"using-multiple-vantage-terraform-resources",level:3},{value:"Feature Requests",id:"feature-requests",level:2}],u={toc:p},c="wrapper";function d(e){let{components:t,...a}=e;return(0,n.kt)(c,(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"terraform-provider"},"Terraform Provider"),(0,n.kt)("p",null,"Vantage is an official HashiCorp partner and offers a Terraform ",(0,n.kt)("em",{parentName:"p"},"module")," for getting up and running with Vantage using Infrastructure as Code (IaC). Vantage also offers a Terraform ",(0,n.kt)("em",{parentName:"p"},"provider")," with several ",(0,n.kt)("em",{parentName:"p"},"resources"),"."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Vantage Terraform Integrations module for AWS"),": The Vantage ",(0,n.kt)("a",{parentName:"li",href:"https://registry.terraform.io/modules/vantage-sh/vantage-integration/aws/latest"},"Terraform Integrations module")," is available for registered users, across all Vantage tiers, to create the primitives needed to broker a connection with AWS. With the module, you can create a Cross-Account IAM Role as well as a Cost and Usage Report (CUR)."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Vantage Terraform provider"),": The ",(0,n.kt)("a",{parentName:"li",href:"https://registry.terraform.io/providers/vantage-sh/vantage/latest/docs"},"Terraform provider")," comprises several Vantage resources you can create, such as Cost Reports, dashboards, etc. Use the provider to automate and manage Vantage from within your existing Terraform codebase. Organizations with IaC practices can set up, create, and sync their cost reporting structure with Vantage.")),(0,n.kt)("h2",{id:"integrations-module"},"Vantage Terraform Integrations Module for AWS"),(0,n.kt)("p",null,"Use the Vantage Integrations module to link your AWS and Vantage accounts. Organizations can leverage the module to integrate thousands of AWS accounts with Vantage. To get set up with this module, see the additional documentation on the ",(0,n.kt)("a",{parentName:"p",href:"https://registry.terraform.io/modules/vantage-sh/vantage-integration/aws/latest"},"Terraform Registry"),"."),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"For root AWS accounts, you will need to provision a CUR bucket using the ",(0,n.kt)("inlineCode",{parentName:"p"},"cur_bucket_name")," variable. For sub-accounts, you will need to link access, but you won't need to configure the CUR bucket.")),(0,n.kt)("p",null,"The below example shows how to add the management (root) AWS account integration where CUR and an S3 bucket are provisioned:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'provider "aws" {\n  region = "us-east-1"\n  assume_role {\n    role_arn = "arn:aws:iam::123456789012:role/admin-role"\n  }\n}\n\nmodule "vantage-integration" {\n  source  = "vantage-sh/vantage-integration/aws"\n\n  # Bucket names must be globally unique. It is provisioned with private acl\'s\n  # and only accessed by Vantage via the provisioned cross account role.\n  cur_bucket_name = "my-company-cur-vantage"\n}\n')),(0,n.kt)("p",null,"The below example shows how to add a member account ",(0,n.kt)("em",{parentName:"p"},"without")," a CUR integration. As a result, an IAM Role is created, which Vantage can assume to ingest the cost and resource metadata that are displayed within the Vantage console. See the ",(0,n.kt)("a",{parentName:"p",href:"https://registry.terraform.io/modules/vantage-sh/vantage-integration/aws/latest"},"Terraform documentation")," for more details."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'provider "aws" {\n  region = "us-east-1"\n  assume_role {\n    role_arn = "arn:aws:iam::123456789012:role/admin-:ew\n    role"\n  }\n}\n\nmodule "vantage-integration" {\n  source  = "vantage-sh/vantage-integration/aws"\n}\n')),(0,n.kt)("h2",{id:"vantage-resources-and-data-sources"},"Vantage Resources and Data Sources"),(0,n.kt)("p",null,"Using the Terraform provider, you can automate Vantage resources, such as Cost Reports, via the ",(0,n.kt)("a",{parentName:"p",href:"https://vantage.readme.io/v2.0/reference/createcostreport"},"Vantage Write API"),"\u2014or the backbone of the provider."),(0,n.kt)("p",null,"With the Terraform provider, you can create many ",(0,n.kt)("a",{parentName:"p",href:"https://developer.hashicorp.com/terraform/language/resources"},"resources"),", like Cost Reports, report notifications, folders, dashboards, etc. The provider also includes many ",(0,n.kt)("a",{parentName:"p",href:"https://developer.hashicorp.com/terraform/language/data-sources"},"data sources")," you can use to pull data from the Vantage console. See the ",(0,n.kt)("a",{parentName:"p",href:"https://registry.terraform.io/providers/vantage-sh/vantage/latest/docs"},"documentation")," for details."),(0,n.kt)("p",null,"By using these Terraform resources, engineering teams automate cost reporting in Vantage. Below are some example use cases."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Build Cost Reports for hundreds of teams stored in another source of truth (e.g., database or GitHub)"),(0,n.kt)("li",{parentName:"ul"},"Update filters as resource names or tags change"),(0,n.kt)("li",{parentName:"ul"},"Add new reports to team dashboards when new services are deployed"),(0,n.kt)("li",{parentName:"ul"},"Create teams and access grants based on teams within an identity provider (IdP)")),(0,n.kt)("admonition",{title:"Important",type:"caution"},(0,n.kt)("p",{parentName:"admonition"},"The ability to create, edit, and destroy resources is keyed to the permissions of the user associated with the API token. For Enterprise customers, role-based access controls also affect these actions. Review the documentation on ",(0,n.kt)("a",{parentName:"p",href:"/rbac"},"RBAC for further information"),".")),(0,n.kt)("h2",{id:"terraform-examples"},"Terraform Examples"),(0,n.kt)("p",null,"Before you begin, ensure you have a valid ",(0,n.kt)("a",{parentName:"p",href:"/vantage_account#api-token"},"Write API token"),"."),(0,n.kt)("h3",{id:"create-a-cost-report"},"Create a Cost Report"),(0,n.kt)("p",null,"The following example describes how to create a Cost Report for AWS using Terraform."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"First, declare the Vantage provider."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'terraform {\n  required_providers {\n    vantage = {\n      source = "vantage-sh/vantage"\n    }\n  }\n}\n\nprovider "vantage" {\n  api_token = var.api_token\n}\n')),(0,n.kt)("admonition",{parentName:"li",type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"You can optionally save your API token as an environment variable and remove the ",(0,n.kt)("inlineCode",{parentName:"p"},'provider "vantage"{...}')," block. Export your token with: ",(0,n.kt)("inlineCode",{parentName:"p"},"export VANTAGE_API_TOKEN=<YOUR_API_TOKEN>"),"."))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Create the ",(0,n.kt)("inlineCode",{parentName:"p"},"vantage_folder"),' resource, with "AWS Costs" as the title.'),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'resource "vantage_folder" "aws" {\ntitle = "AWS Costs"\n}\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Create the ",(0,n.kt)("inlineCode",{parentName:"p"},"vantage_cost_report")," resource using the token output from the ",(0,n.kt)("inlineCode",{parentName:"p"},"vantage_folder"),' resource. The Cost Report will be stored in the newly created AWS folder. The Cost Report\'s title is "AWS Costs." In addition, the ',(0,n.kt)("inlineCode",{parentName:"p"},"vantage_saved_filter")," resource includes a ",(0,n.kt)("inlineCode",{parentName:"p"},"filter")," parameter that uses ",(0,n.kt)("a",{parentName:"p",href:"/vql"},"Vantage Query Language (VQL)"),", a SQL-like language for querying cloud cost and usage data. Here, the filter is set to show only AWS costs. Set the ",(0,n.kt)("inlineCode",{parentName:"p"},"groupings")," parameter to have the report grouped by region and service."),(0,n.kt)("admonition",{parentName:"li",type:"tip"},(0,n.kt)("p",{parentName:"admonition"},"Valid groupings include: ",(0,n.kt)("inlineCode",{parentName:"p"},"account_id"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"billing_account_id"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"charge_type"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"cost_category"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"cost_subcategory"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"provider"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"region"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"resource_id"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"service"),", ",(0,n.kt)("inlineCode",{parentName:"p"},"tag:<tag_value>"),". Enter multiple groupings as comma-separated values: ",(0,n.kt)("inlineCode",{parentName:"p"},"groupings=provider,service,region"),".")),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'resource "vantage_cost_report" "aws" {\n  folder_token = vantage_folder.aws.token\n  filter       = "costs.provider = \'aws\'"\n  title        = "AWS Costs"\n  groupings    = "region,service"\n}\n')))),(0,n.kt)("h3",{id:"using-multiple-vantage-terraform-resources"},"Using Multiple Vantage Terraform Resources"),(0,n.kt)("p",null,"In the following example, we will create a filter, report, and folder to track database costs. This example assumes you've already declared the appropriate providers."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"First, create an RDS instance using the ",(0,n.kt)("inlineCode",{parentName:"p"},"aws_db_instance")," resource from the AWS provider. Then, create a saved filter using the output of the ",(0,n.kt)("inlineCode",{parentName:"p"},"arn")," from the RDS instance as part of the filter criteria."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'resource "aws_db_instance" "rds" {\n  allocated_storage    = 10\n  db_name              = "primary-database"\n  engine               = "mysql"\n  instance_class       = "db.t3.micro"\n  username             = "admin"\n  password             = "password"\n}\n\nresource "vantage_saved_filter" "rds" {\n  title  = "rds-costs"\n  filter = "costs.provider=\'aws\' AND costs.resource_id = \'${aws_db_instance.rds.arn}\' AND costs.service = \'Amazon Relational Database Service\'"\n}\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Then, create a folder to keep your RDS Cost Reports organized."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'resource "vantage_folder" "rds" {\n  title = "RDS Costs"\n}\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Finally, use the tokens that are output from the saved filter and folder as input to create a new Cost Report."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'resource "vantage_cost_report" "rds_costs" {\n  folder_token        = vantage_folder.rds.token\n  saved_filter_tokens = [vantage_saved_filter.rds.token]\n  title               = "RDS Costs"\n}\n')))),(0,n.kt)("p",null,"In this manner, initial setup, deployments, and infrastructure changes are synced to Vantage. Further examples can be found in the ",(0,n.kt)("inlineCode",{parentName:"p"},"terraform-provider-vantage")," ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/vantage-sh/terraform-provider-vantage/tree/main/examples"},"GitHub repository"),"."),(0,n.kt)("h2",{id:"feature-requests"},"Feature Requests"),(0,n.kt)("p",null,"To request additional features, please open an issue on ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/vantage-sh/terraform-aws-vantage-integration"},"GitHub")," or email us at ",(0,n.kt)("a",{parentName:"p",href:"mailto:support@vantage.sh"},"support@vantage.sh"),"."))}d.isMDXComponent=!0}}]);