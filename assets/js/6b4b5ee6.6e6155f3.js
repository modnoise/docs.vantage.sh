"use strict";(self.webpackChunkdocs_vantage_sh=self.webpackChunkdocs_vantage_sh||[]).push([[8123],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(n),d=o,h=m["".concat(l,".").concat(d)]||m[d]||p[d]||r;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},8717:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var a=n(7462),o=(n(7294),n(3905));const r={},i="Setup AWS",s={unversionedId:"connecting_aws",id:"connecting_aws",title:"Setup AWS",description:"Connecting Your AWS Account",source:"@site/docs/connecting_aws.md",sourceDirName:".",slug:"/connecting_aws",permalink:"/connecting_aws",draft:!1,editUrl:"https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/connecting_aws.md",tags:[],version:"current",frontMatter:{},sidebar:"someSidebar",previous:{title:"Security",permalink:"/security"},next:{title:"AWS Permissions",permalink:"/permissions_aws"}},l={},c=[{value:"Connecting Your AWS Account",id:"connecting-your-aws-account",level:2},{value:"Read-Only by Default",id:"read-only-by-default",level:3},{value:"Connecting Multiple AWS Accounts",id:"connecting-multiple-aws-accounts",level:2},{value:"StackSet Prerequisites",id:"stackset-prerequisites",level:3},{value:"Connecting with Terraform",id:"connecting-with-terraform",level:2},{value:"Connecting by Manually Creating an IAM Role",id:"connecting-by-manually-creating-an-iam-role",level:2},{value:"AWS Data Ingestion Delay",id:"aws-data-ingestion-delay",level:2}],u={toc:c},m="wrapper";function p(e){let{components:t,...n}=e;return(0,o.kt)(m,(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"setup-aws"},"Setup AWS"),(0,o.kt)("h2",{id:"connecting-your-aws-account"},"Connecting Your AWS Account"),(0,o.kt)("p",null,"Vantage understands security concerns and aims to provide as secure of a connection as possible with your AWS accounts. Vantage uses a mechanism called a ",(0,o.kt)("em",{parentName:"p"},"Cross-Account IAM Role")," to interact with services in your AWS account. AWS has ",(0,o.kt)("a",{parentName:"p",href:"https://aws.amazon.com/blogs/apn/securely-accessing-customer-aws-accounts-with-cross-account-iam-roles/"},"publicly documented")," this method and officially recommends it as the preferred method of doing any cross-account interactions on AWS. Numerous internal AWS services and systems also leverage this method."),(0,o.kt)("p",null,"This means that Vantage ",(0,o.kt)("strong",{parentName:"p"},"never")," needs access credentials, account logins, or passwords for AWS."),(0,o.kt)("h3",{id:"read-only-by-default"},"Read-Only by Default"),(0,o.kt)("p",null,"When you create a Cross-Account IAM Role using the provided CloudFormation template or by running the Terraform below, you provide Vantage with various ",(0,o.kt)("a",{parentName:"p",href:"https://docs.vantage.sh/permissions_aws/"},"permissions"),". All these permissions, by default, are read-only. We created this list of permissions based on the official ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/aws-managed-policy/latest/reference/ReadOnlyAccess.html"},"AWS ReadOnlyAccess policy"),". In addition, we removed some of the permissions AWS includes in this list to prevent Vantage from seeing information like reading from S3 buckets and reading from databases."),(0,o.kt)("p",null,"Vantage only collects metadata about your infrastructure and never attempts to read sensitive information from the underlying services. Our CloudFormation template is public, and you can ",(0,o.kt)("a",{parentName:"p",href:"https://vantage-public.s3.amazonaws.com/vantage-integration-latest.json"},"audit the template's list of permissions here"),"."),(0,o.kt)("h2",{id:"connecting-multiple-aws-accounts"},"Connecting Multiple AWS Accounts"),(0,o.kt)("p",null,"Vantage allows you to connect multiple AWS accounts; however, we strongly advise that you connect your ",(0,o.kt)("strong",{parentName:"p"},"root or management")," AWS account first. When you connect the root account, you can see all costs for the organization, including linked accounts."),(0,o.kt)("admonition",{title:"If you only connect a linked or member account you will experience the following issues:",type:"info"},(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"You will see only costs and costs by resource for that linked account rather than for your whole organization."),(0,o.kt)("li",{parentName:"ul"},"You will be unable to see costs for the other member accounts in your AWS organization."),(0,o.kt)("li",{parentName:"ul"},"You may not see the full coverage of cost allocation tags from the organization."),(0,o.kt)("li",{parentName:"ul"},"If Reserved Instances (RIs) are purchased in the linked account, those instances will be realized in the linked account first instead of being realized across the organization."))),(0,o.kt)("p",null,"Once you connect your root/management AWS account, Vantage will profile for all member accounts present in the organization. Vantage will be able to show you accrued costs from all member accounts in the organization as well as Active Resources that are present in that ",(0,o.kt)("em",{parentName:"p"},"root AWS account"),"."),(0,o.kt)("p",null,"If you have multiple member accounts and want to view Active Resources present in those accounts, you can run a CloudFormation StackSet that will create one role per AWS member account. You're also welcome to skip this step and add/remove AWS accounts from your ",(0,o.kt)("a",{parentName:"p",href:"https://console.vantage.sh/settings/workspaces"},"account settings")," whenever you want."),(0,o.kt)("p",null,"We recommend using StackSets if you have several accounts you want to connect. This will automate the process for all the accounts in your organizational unit. When connecting your account, if you have at least one member account, you will see instructions specific to your account on how to connect your member accounts using StackSets."),(0,o.kt)("h3",{id:"stackset-prerequisites"},"StackSet Prerequisites"),(0,o.kt)("p",null,"To leverage StackSets, you must enable your organization's access to operate a service-managed StackSet. You'll need to enable this setting in the AWS Management Console. If you don't have this setting enabled and attempt to run a StackSet command, you'll see the following error:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"An error occurred (ValidationError) when calling the CreateStackSet operation: You must enable organizations access to operate a service managed stack set")),(0,o.kt)("p",null,"For more information, see ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/stacksets-prereqs.html"},"AWS's instructions")," for enabling this setting."),(0,o.kt)("h2",{id:"connecting-with-terraform"},"Connecting with Terraform"),(0,o.kt)("p",null,"During onboarding, instead of following the CloudFormation process, you can use our Terraform module. Refer to the ",(0,o.kt)("a",{parentName:"p",href:"/terraform/"},"Terraform documentation")," for the needed commands."),(0,o.kt)("h2",{id:"connecting-by-manually-creating-an-iam-role"},"Connecting by Manually Creating an IAM Role"),(0,o.kt)("p",null,"If you want to create IAM roles manually or use another tool to manage your infrastructure, you can create the necessary cross-account role. During onboarding, instead of following the CloudFormation process, select the ",(0,o.kt)("strong",{parentName:"p"},"IAM Role")," option. You will be presented with a Trust Relationship and an Inline Policy that is required for the role. After creating the role, return to the onboarding page and submit the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/reference-arns.html"},"ARN")," of the created role to complete the connection."),(0,o.kt)("h2",{id:"aws-data-ingestion-delay"},"AWS Data Ingestion Delay"),(0,o.kt)("p",null,"As of June 2022, Vantage now creates both an IAM role as well as a ",(0,o.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/cur/latest/userguide/cur-create.html"},"Cost and Usage Report")," integration through the same provided CloudFormation template and Terraform file. While an IAM role is created within a minute, and historical data can be populated almost immediately, it can take AWS around 6 or 7 hours to deliver the first Cost and Usage Report to Vantage. As a result, only partial data will be present until this first Cost and Usage Report is received."),(0,o.kt)("p",null,"This will impact a few features in the Vantage console:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/active_resources"},"Active Resources")," will initially show only hourly and monthly ",(0,o.kt)("em",{parentName:"li"},"rates"),". When the first Cost and Usage Report is received, you can see actual accrued costs per resource, broken down by cost category and subcategory."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/cost_reports"},"Cost Reports"),' will show line-item data per service initially but will not be able to show "costs by resource" until the first Cost and Usage Report report is received.'),(0,o.kt)("li",{parentName:"ul"},"Both ",(0,o.kt)("a",{parentName:"li",href:"/autopilot/"},"Autopilot")," and ",(0,o.kt)("a",{parentName:"li",href:"/savings_planner/"},"Savings Planner")," are unavailable until this first Cost and Usage Report is received.")),(0,o.kt)("p",null,"Once Vantage receives its first Cost and Usage Report, this functionality will automatically be made available, and Vantage will alert you via email. Ultimately, this is a limitation imposed by AWS, and we need to wait for them to deliver this data."))}p.isMDXComponent=!0}}]);