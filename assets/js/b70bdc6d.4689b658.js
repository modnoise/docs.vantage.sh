"use strict";(self.webpackChunkdocs_vantage_sh=self.webpackChunkdocs_vantage_sh||[]).push([[1009],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>g});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=a.createContext({}),p=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),m=p(r),c=n,g=m["".concat(l,".").concat(c)]||m[c]||d[c]||o;return r?a.createElement(g,s(s({ref:t},u),{},{components:r})):a.createElement(g,s({ref:t},u))}));function g(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,s=new Array(o);s[0]=c;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[m]="string"==typeof e?e:n,s[1]=i;for(var p=2;p<o;p++)s[p]=r[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,r)}c.displayName="MDXCreateElement"},9379:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>p});var a=r(7462),n=(r(7294),r(3905));const o={id:"terraform",title:"Terraform Provider",description:"Use the Vantage provider for Terraform as part of your FinOps as Code toolkit. Create Terraform cost reporting resources.",keywords:["Terraform"]},s="Terraform Provider",i={unversionedId:"terraform",id:"terraform",title:"Terraform Provider",description:"Use the Vantage provider for Terraform as part of your FinOps as Code toolkit. Create Terraform cost reporting resources.",source:"@site/docs/terraform.md",sourceDirName:".",slug:"/terraform",permalink:"/terraform",draft:!1,editUrl:"https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/terraform.md",tags:[],version:"current",frontMatter:{id:"terraform",title:"Terraform Provider",description:"Use the Vantage provider for Terraform as part of your FinOps as Code toolkit. Create Terraform cost reporting resources.",keywords:["Terraform"]},sidebar:"someSidebar",previous:{title:"API",permalink:"/api"},next:{title:"VQL (Vantage Query Language)",permalink:"/vql"}},l={},p=[{value:"Vantage Terraform Integrations Module for AWS",id:"integrations-module",level:2},{value:"Vantage Resources",id:"vantage-resources",level:2},{value:"Terraform Examples",id:"terraform-examples",level:2},{value:"Create a Cost Report",id:"create-a-cost-report",level:3},{value:"Using Multiple Vantage Terraform Resources",id:"using-multiple-vantage-terraform-resources",level:3},{value:"Future Primitive Support",id:"future-primitive-support",level:2},{value:"Feature Requests",id:"feature-requests",level:2}],u={toc:p},m="wrapper";function d(e){let{components:t,...r}=e;return(0,n.kt)(m,(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"terraform-provider"},"Terraform Provider"),(0,n.kt)("p",null,"Vantage is an official HashiCorp partner and offers a Terraform ",(0,n.kt)("em",{parentName:"p"},"module")," for getting up and running with Vantage using Infrastructure as Code (IaC). Vantage also offers a Terraform ",(0,n.kt)("em",{parentName:"p"},"provider")," with a number of ",(0,n.kt)("em",{parentName:"p"},"resources"),"."),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Vantage Terraform Integrations module for AWS"),": The Vantage ",(0,n.kt)("a",{parentName:"li",href:"https://registry.terraform.io/modules/vantage-sh/vantage-integration/aws/latest"},"Terraform Integrations module")," is available for registered users, across all Vantage tiers, to create the primitives needed to broker a connection with AWS. With the module, you can create a Cross-Account IAM Role as well as a Cost and Usage Report (CUR)."),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Vantage Terraform provider"),": The ",(0,n.kt)("a",{parentName:"li",href:"https://registry.terraform.io/providers/vantage-sh/vantage/latest/docs"},"Terraform provider")," comprises a number of Vantage resources you can create, such as Cost Reports, Dashboards, etc. The Terraform provider makes it possible to fully automate and manage Vantage from within your existing Terraform codebase. Companies with IaC practices can set up, create, and sync their cost reporting structure with Vantage.")),(0,n.kt)("h2",{id:"integrations-module"},"Vantage Terraform Integrations Module for AWS"),(0,n.kt)("p",null,"Use the Vantage Integrations module to link your AWS and Vantage accounts. Organizations can leverage the module to integrate thousands of AWS accounts with Vantage. To get set up with this module, see the additional documentation on the ",(0,n.kt)("a",{parentName:"p",href:"https://registry.terraform.io/modules/vantage-sh/vantage-integration/aws/latest"},"Terraform Registry"),"."),(0,n.kt)("admonition",{type:"note"},(0,n.kt)("p",{parentName:"admonition"},"For root AWS accounts, you will need to provision a CUR bucket using the ",(0,n.kt)("inlineCode",{parentName:"p"},"cur_bucket_name")," variable. For subaccounts, you will need to link access, but you won't need to configure the CUR bucket.")),(0,n.kt)("p",null,"The below example shows how to add a member account ",(0,n.kt)("em",{parentName:"p"},"without")," a CUR integration. As a result, an IAM Role is created, which Vantage can assume to ingest the cost and resource metadata that's displayed within the Vantage console. See the ",(0,n.kt)("a",{parentName:"p",href:"https://registry.terraform.io/modules/vantage-sh/vantage-integration/aws/latest"},"Terraform documentation")," for more details."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'provider "aws" {\n  region = "us-east-1"\n  assume_role {\n    role_arn = "arn:aws:iam::123456789012:role/admin-:ew\n    role"\n  }\n}\n\nmodule "vantage-integration" {\n  source  = "vantage-sh/vantage-integration/aws"\n}\n')),(0,n.kt)("h2",{id:"vantage-resources"},"Vantage Resources"),(0,n.kt)("p",null,"Using the Terraform provider, you can automate Vantage resources, such as Cost Reports, via the ",(0,n.kt)("a",{parentName:"p",href:"https://vantage.readme.io/v2.0/reference/createcostreport"},"Vantage Write API"),"\u2014or the backbone of the provider."),(0,n.kt)("p",null,"With the ",(0,n.kt)("a",{parentName:"p",href:"https://registry.terraform.io/providers/vantage-sh/vantage/latest/docs"},"Terraform provider"),", you can create the following resources:"),(0,n.kt)("table",null,(0,n.kt)("thead",{parentName:"table"},(0,n.kt)("tr",{parentName:"thead"},(0,n.kt)("th",{parentName:"tr",align:null},"Resource"),(0,n.kt)("th",{parentName:"tr",align:null},"Terraform Resource Name"),(0,n.kt)("th",{parentName:"tr",align:null},"Documentation"))),(0,n.kt)("tbody",{parentName:"table"},(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Cost Report"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"vantage_cost_report")),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://registry.terraform.io/providers/vantage-sh/vantage/latest/docs/resources/cost_report"},"View documentation"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Dashboard"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"vantage_dashboard")),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://registry.terraform.io/providers/vantage-sh/vantage/latest/docs/resources/dashboard"},"View documentation"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Folder"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"vantage_folder")),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://registry.terraform.io/providers/vantage-sh/vantage/latest/docs/resources/folder"},"View documentation"))),(0,n.kt)("tr",{parentName:"tbody"},(0,n.kt)("td",{parentName:"tr",align:null},"Saved Filter"),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("inlineCode",{parentName:"td"},"vantage_saved_filter")),(0,n.kt)("td",{parentName:"tr",align:null},(0,n.kt)("a",{parentName:"td",href:"https://registry.terraform.io/providers/vantage-sh/vantage/latest/docs/resources/saved_filter"},"View documentation"))))),(0,n.kt)("p",null,"By using these Terraform resources, engineering teams automate cost reporting in Vantage. Below are some example use cases:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Build Cost Reports for hundreds of teams stored in another source of truth (e.g., database or GitHub)"),(0,n.kt)("li",{parentName:"ul"},"Update filters as resource names or tags change"),(0,n.kt)("li",{parentName:"ul"},"Add new reports to team dashboards when new services are deployed")),(0,n.kt)("h2",{id:"terraform-examples"},"Terraform Examples"),(0,n.kt)("h3",{id:"create-a-cost-report"},"Create a Cost Report"),(0,n.kt)("p",null,"The following example shows how to create a Cost Report for AWS using Terraform. "),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"First, declare the Vantage provider."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'terraform {\n  required_providers {\n    vantage = {\n      source = "vantage-sh/vantage"\n    }\n  }\n}\n\nprovider "vantage" {\n  api_token = var.api_token\n}\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Create the ",(0,n.kt)("inlineCode",{parentName:"p"},"vantage_folder"),' resource, with "AWS Costs" as the title.'),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'resource "vantage_folder" "aws" {\ntitle = "AWS Costs"\n}\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Create the ",(0,n.kt)("inlineCode",{parentName:"p"},"vantage_cost_report")," resource using the token output from the ",(0,n.kt)("inlineCode",{parentName:"p"},"vantage_folder"),' resource. The Cost Report will be stored in the newly created AWS folder. The Cost Report\'s title is "AWS Costs." In addition, the ',(0,n.kt)("inlineCode",{parentName:"p"},"vantage_saved_filter")," resource includes a ",(0,n.kt)("inlineCode",{parentName:"p"},"filter")," parameter that uses ",(0,n.kt)("a",{parentName:"p",href:"/vql"},"Vantage Query Language (VQL)"),", a SQL-like language for querying cloud cost and usage data. Here, the filter is set to show only AWS costs."),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'resource "vantage_cost_report" "aws" {\n  folder_token = vantage_folder.aws.token\n  filter       = "costs.provider = \'aws\'"\n  title        = "AWS Costs"\n}\n')))),(0,n.kt)("h3",{id:"using-multiple-vantage-terraform-resources"},"Using Multiple Vantage Terraform Resources"),(0,n.kt)("p",null,"In the following example, we will create a filter, report, and folder to track database costs. This example assumes you've already declared the appropriate providers."),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"First, create an RDS instance using the ",(0,n.kt)("inlineCode",{parentName:"p"},"aws_db_instance")," resource from the AWS provider. Then, create a saved filter using the output of the ",(0,n.kt)("inlineCode",{parentName:"p"},"arn")," from the RDS instance as part of the filter criteria. "),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'resource "aws_db_instance" "rds" {\n  allocated_storage    = 10\n  db_name              = "primary-database"\n  engine               = "mysql"\n  instance_class       = "db.t3.micro"\n  username             = "admin"\n  password             = "password"\n}\n\nresource "vantage_saved_filter" "rds" {\n  title  = "rds-costs"\n  filter = "costs.provider=\'aws\' AND costs.resource_id = \'${aws_db_instance.rds.arn}\' AND costs.service = \'Amazon Relational Database Service\'"\n}\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Then, create a folder to keep your RDS Cost Reports organized. "),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'resource "vantage_folder" "rds" {\n  title = "RDS Costs"\n}\n'))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Finally, use the tokens that are output from the saved filter and folder as input to create a new Cost Report. "),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-bash"},'resource "vantage_cost_report" "rds_costs" {\n  folder_token        = vantage_folder.rds.token\n  saved_filter_tokens = [vantage_saved_filter.rds.token]\n  title               = "RDS Costs"\n}\n')))),(0,n.kt)("p",null,"In this manner, initial setup, deployments, and infrastructure changes are synced to Vantage. Further examples can be found in the ",(0,n.kt)("inlineCode",{parentName:"p"},"terraform-provider-vantage")," ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/vantage-sh/terraform-provider-vantage/tree/main/examples"},"GitHub repository"),"."),(0,n.kt)("h2",{id:"future-primitive-support"},"Future Primitive Support"),(0,n.kt)("p",null,"Vantage is in process of expanding the API to support all resources within Vantage. Some future primitives the Terraform provider will support include:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/segments"},"Segments")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/budgets"},"Budgets")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/per_unit_costs#importing-business-metrics"},"Business Metrics"))),(0,n.kt)("p",null,"These capabilities will expand the automation capabilities of Vantage through some of the following use cases:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"Push company metrics to Vantage"),(0,n.kt)("li",{parentName:"ul"},"Sync and update budgets")),(0,n.kt)("h2",{id:"feature-requests"},"Feature Requests"),(0,n.kt)("p",null,"To request additional features, please open an issue on ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/vantage-sh/terraform-aws-vantage-integration"},"GitHub")," or email us at ",(0,n.kt)("a",{parentName:"p",href:"mailto:support@vantage.sh"},"support@vantage.sh"),"."))}d.isMDXComponent=!0}}]);