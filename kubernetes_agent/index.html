<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-kubernetes_agent">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Vantage Kubernetes Agent | Vantage Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://assets.vantage.sh/blog/vntg-social-preview.png"><meta data-rh="true" name="twitter:image" content="https://assets.vantage.sh/blog/vntg-social-preview.png"><meta data-rh="true" property="og:url" content="https://docs.vantage.sh/kubernetes_agent"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Vantage Kubernetes Agent | Vantage Documentation"><meta data-rh="true" name="description" content="This page walks through how to connect the Vantage Kubernetes agent with your Kubernetes cluster."><meta data-rh="true" property="og:description" content="This page walks through how to connect the Vantage Kubernetes agent with your Kubernetes cluster."><link data-rh="true" rel="icon" href="https://assets.vantage.sh/www/favicon-32x32.png"><link data-rh="true" rel="canonical" href="https://docs.vantage.sh/kubernetes_agent"><link data-rh="true" rel="alternate" href="https://docs.vantage.sh/kubernetes_agent" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.vantage.sh/kubernetes_agent" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://FETJSHIQX2-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Vantage Documentation" href="/opensearch.xml">


<link rel="preconnect" href="https://www.googletagmanager.com">
<script>window.dataLayer=window.dataLayer||[]</script>
<script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-TSMQ34V",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script><link rel="stylesheet" href="/assets/css/styles.1358fc9e.css">
<link rel="preload" href="/assets/js/runtime~main.96835d8b.js" as="script">
<link rel="preload" href="/assets/js/main.5c46ef5e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>



<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TSMQ34V" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://vantage.sh" target="_self" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/nav-logo.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/nav-logo.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a><a href="https://vantage.readme.io/reference/general" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API</a><a href="https://vantage.sh/pricing" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Pricing</a></div><div class="navbar__items navbar__items--right"><a href="https://console.vantage.sh/signup" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Sign Up</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Get Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/getting_started">Quickstart</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/team_accountability">User Workflow Guides</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Security and Access</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/security">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vantage_account">Account Settings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/sso">Single Sign-On (SSO)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/rbac">Role-Based Access Control (RBAC)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/workspaces">Workspaces</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">API and Terraform</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/api">API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/terraform">Terraform Provider</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/vql">VQL (Vantage Query Language)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/data_dictionary">Data Dictionary</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Integrations</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/connecting_aws">AWS</a><button aria-label="Toggle the collapsible sidebar category &#x27;AWS&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/connecting_azure">Azure</a><button aria-label="Toggle the collapsible sidebar category &#x27;Azure&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/connecting_gcp">Google Cloud</a><button aria-label="Toggle the collapsible sidebar category &#x27;Google Cloud&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/connecting_kubernetes">Kubernetes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Kubernetes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/kubernetes_agent">Vantage Kubernetes Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/opencost">Kubernetes (OpenCost)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes_container_insights">Kubernetes (Container Insights)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/kubernetes">Kubernetes Costs</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/connecting_datadog">Datadog</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/connecting_new_relic">New Relic</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/connecting_mongodb-atlas">MongoDB Atlas</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/connecting_snowflake">Snowflake</a><button aria-label="Toggle the collapsible sidebar category &#x27;Snowflake&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/connecting_databricks">Databricks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/connecting_fastly">Fastly</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/connecting_oracle">Oracle Cloud</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/connecting_confluent">Confluent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/connecting_planetscale">PlanetScale</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Cost Reporting Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/cost_reports">Cost Reports</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cost Reports&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/annotations">Annotations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/forecasting">Forecasting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/active_resources">Resource Reports</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/segments">Segments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cost_anomaly_alerts">Anomaly Detection</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/reports">Cost Report Notifications</a><button aria-label="Toggle the collapsible sidebar category &#x27;Cost Report Notifications&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Financial Planning Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/autopilot">Autopilot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/budgets">Budgets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/per_unit_costs">Per Unit Costs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/issues">Issues</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/savings_planner">Savings Planner</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cost_recommendations">Cost Recommendations</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Integrations</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/connecting_kubernetes"><span itemprop="name">Kubernetes</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Vantage Kubernetes Agent</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Vantage Kubernetes Agent</h1><p>The Vantage Kubernetes agent is the default, recommended configuration to ingest cost and usage data from Kubernetes clusters to Vantage. The agent is a Docker container that&#x27;s run in your Kubernetes cluster. The agent collects metrics and uploads them to Vantage. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="agent-functionality">Agent Functionality<a href="#agent-functionality" class="hash-link" aria-label="Direct link to Agent Functionality" title="Direct link to Agent Functionality">​</a></h2><p>The Vantage Kubernetes agent relies on native Kubernetes APIs, such as <code>kube-apiserver</code> for metadata and <code>kubelet</code> for container data. Access to these APIs is controlled via Kubernetes RBAC using a Service Account and ClusterRole, included in the Vantage Kubernetes agent <a href="https://github.com/vantage-sh/helm-charts" target="_blank" rel="noopener noreferrer">Helm chart</a>. </p><p>Data is periodically collected and stored for aggregation, then sent directly to the Vantage service through an API, with your Vantage API token for authentication. This process avoids extra storage costs incurred by the OpenCost integration. The agent&#x27;s architecture eliminates the need for deploying OpenCost-specific Prometheus pods, which makes scaling easier. </p><div style="display:flex;justify-content:center;border-radius:10px;box-shadow:0 2px 4px rgba(0, 0, 0, 0.1)"><img loading="lazy" alt="Vantage Kubernetes agent architecture diagram" width="60%" src="https://assets.vantage.sh/blog/announcing-the-official-kubernetes-integration/vantage-kubernetes-agent-architecture.png" style="border-radius:10px" class="img_ev3q"></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="service-compatibility">Service Compatibility<a href="#service-compatibility" class="hash-link" aria-label="Direct link to Service Compatibility" title="Direct link to Service Compatibility">​</a></h2><p>The Vantage Kubernetes agent is compatible with the following services: </p><ul><li>Amazon Elastic Kubernetes Service (EKS)</li><li>Azure Kubernetes Service (AKS)</li><li>Google Kubernetes Engine (GKE)</li></ul><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>At this time, the agent does not support custom rates for on-premises servers. Note that this is a planned future feature. If you have an on-premises cluster and would like to track these costs, see the <a href="/opencost">OpenCost</a> documentation.</p></div></div><p>As long as the cost data for an underlying cluster instance is ingested into Vantage via a cloud integration, it is possible to calculate the corresponding pod costs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="install-vantage-kubernetes-agent">Install Vantage Kubernetes Agent<a href="#install-vantage-kubernetes-agent" class="hash-link" aria-label="Direct link to Install Vantage Kubernetes Agent" title="Direct link to Install Vantage Kubernetes Agent">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h3><p>The following prerequisites are required before you install the Vantage Kubernetes agent:</p><ul><li><p>The <a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm package manager</a> for Kubernetes </p></li><li><p><code>kubectl</code></p></li><li><p>A running Kubernetes cluster</p></li><li><p>A <a href="/vantage_account#api-token">Vantage API token</a> with READ and WRITE scopes enabled</p></li><li><p><strong>If you do not already have an integration enabled</strong>, navigate to the <a href="https://console.vantage.sh/settings/kubernetes?connect=true" target="_blank" rel="noopener noreferrer">Kubernetes Integration page</a> in the Vantage console, and click the <strong>Enable Kubernetes Agent</strong> button (you won&#x27;t need to do this for subsequent integrations)</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-a-connection">Create a Connection<a href="#create-a-connection" class="hash-link" aria-label="Direct link to Create a Connection" title="Direct link to Create a Connection">​</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>The following steps are also provided in the Vantage Kubernetes agent Helm chart repository. See <a href="https://github.com/vantage-sh/helm-charts/tree/main/charts/vantage-kubernetes-agent" target="_blank" rel="noopener noreferrer">the Helm chart repository</a> for all value configurations.</p></div></div><p>To set up a <em>new</em> Kubernetes agent connection:</p><ol><li><p>Add the repository for the Vantage Kubernetes agent Helm chart. </p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> vantage https://vantage-sh.github.io/helm-charts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Install the <code>vantage-kubernetes-agent</code> Helm chart. Ensure you update the values for <code>VANTAGE_API_TOKEN</code> (obtained in the <a href="/kubernetes_agent#prerequisites">Prerequisites</a> above) and <code>CLUSTER_ID</code> (the unique value for your cluster).</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade -n vantage vka vantage/vantage-kubernetes-agent --install --set agent.token</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$VANTAGE_API_TOKEN</span><span class="token plain">,agent.clusterID</span><span class="token operator" style="color:#393A34">=</span><span class="token variable" style="color:#36acaa">$CLUSTER_ID</span><span class="token plain"> --create-namespace</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="enable-annotations-namespace-labels">(Optional) Enable Collection of Annotations and Namespace Labels<a href="#enable-annotations-namespace-labels" class="hash-link" aria-label="Direct link to (Optional) Enable Collection of Annotations and Namespace Labels" title="Direct link to (Optional) Enable Collection of Annotations and Namespace Labels">​</a></h3><p>You can optionally enable the collection of Annotations and Namespace labels.</p><ul><li><strong>Annotations.</strong> The agent accepts a comma-separated list of annotation keys, called <code>VANTAGE_ALLOWED_ANNOTATIONS</code>, as an environment variable at startup. To enable collection of Annotations, configure the <code>agent.allowedAnnotations</code> <a href="https://github.com/vantage-sh/helm-charts/blob/main/charts/vantage-kubernetes-agent/values.yaml#L31" target="_blank" rel="noopener noreferrer">parameter of the Helm chart</a> with a list of Annotations to be sent to Vantage. Note there is a max of 10 annotations, and values are truncated after 100 characters.</li><li><strong>Namespace labels.</strong> The agent accepts <code>VANTAGE_COLLECT_NAMESPACE_LABELS</code> as an environment variable at startup. To enable collection of Namespace labels, configure the <code>agent.collectNamespaceLabels</code> <a href="https://github.com/vantage-sh/helm-charts/blob/main/charts/vantage-kubernetes-agent/values.yaml#L34" target="_blank" rel="noopener noreferrer">parameter of the Helm chart</a>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="resource-usage">Resource Usage<a href="#resource-usage" class="hash-link" aria-label="Direct link to Resource Usage" title="Direct link to Resource Usage">​</a></h3><p>The limits provided within the Helm chart are set low to support small clusters (approximately 10 nodes) and should be considered the minimum values for deploying an agent.</p><p>Estimates for larger clusters are roughly:</p><ul><li>~1 CPU/1000 node</li><li>~2 MB/node</li></ul><p>For example, a 100-node cluster would be approximately 200 MB and 100 mCPU. These amounts are estimates, which will vary based on node density, label usage, cluster activity, etc. The agent should reach an approximate steady state after about one hour of uptime and can be tuned accordingly after the fact.</p><p>To set these options, extend the <code>--set</code> flag. You can also include the values using one of the <a href="https://helm.sh/docs/chart_template_guide/values_files/" target="_blank" rel="noopener noreferrer">many options Helm supports</a>:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">--set agent.token=$VANTAGE_API_TOKEN,agent.clusterID=$CLUSTER_ID,resources.limits.memory=100Mi,resources.requests.memory=100Mi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="validate-installation">Validate Installation<a href="#validate-installation" class="hash-link" aria-label="Direct link to Validate Installation" title="Direct link to Validate Installation">​</a></h3><p>Follow the steps below to validate the agent&#x27;s installation. </p><ol><li>Once installed, the agent&#x27;s pod should become <code>READY</code>:<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜ kubectl -n vantage get po</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME                             READY   STATUS    RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">vka-vantage-kubernetes-agent-0   </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1     Running   </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          54m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>Logs should be free of <code>ERROR</code> messages:<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  containers kubectl -n vantage logs -f vka-vantage-kubernetes-agent-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;2023-10-23T22:01:12.065481528Z&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;level&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;msg&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;found nodes&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;nodes&quot;</span><span class="token plain">:231</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;2023-10-23T22:01:15.471399742Z&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;level&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;msg&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;finished initializing&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li>Agent reporting should occur once per hour at the start of the hour and should not generate an <code>ERROR</code> log line. It should also attempt a report soon after the initial start:<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;2023-10-23T22:01:00.015243974Z&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;level&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;msg&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;reporting now&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;2023-10-23T22:01:01.168390414Z&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;level&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;msg&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;finished reporting&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;2023-10-23T22:01:01.169876296Z&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;level&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;INFO&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;msg&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;next report window&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;start&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;2023-10-23T22:00:00Z&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;end&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;2023-10-23T23:00:00Z&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;sleeping_seconds&quot;</span><span class="token plain">:3598.830199804</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ol><p>Costs are exported from the cluster hourly and then made available nightly. It&#x27;s important to note that these costs might encounter delays based on their associated cloud integration&#x27;s cost data. For instance, if there is a one-day delay in an AWS Cost and Usage Report, the clusters dependent on that data will experience a similar delay.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>You can view and manage your Kubernetes integration on <a href="https://console.vantage.sh/settings/kubernetes" target="_blank" rel="noopener noreferrer">Kubernetes Integration page</a> in the console. Hover over the integration in the list, and click <strong>Manage</strong>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="common-errors">Common Errors<a href="#common-errors" class="hash-link" aria-label="Direct link to Common Errors" title="Direct link to Common Errors">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dns-lookup-error">DNS Lookup Error<a href="#dns-lookup-error" class="hash-link" aria-label="Direct link to DNS Lookup Error" title="Direct link to DNS Lookup Error">​</a></h3><p>The agent uses the <a href="https://kubernetes.io/docs/reference/node/node-status/#addresses" target="_blank" rel="noopener noreferrer">node status addresses</a> to determine what hostname to look up for the node&#x27;s stats, which are available via the <code>/metrics/resource</code> endpoint. This can be configured with the <code>VANTAGE_NODE_ADDRESS_TYPES</code> environment variable, which is controlled by the <code>agent.nodeAddressTypes</code> in the Helm chart. By default, the priority order is <code>Hostname,InternalDNS,InternalIP,ExternalDNS,ExternalIP</code>.</p><p>To understand which type to use for your cluster, you can look at the available addresses for one of your nodes. The <code>type</code> corresponds to one of the configurable <code>nodeAddressTypes</code>.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">➜  kubectl get nodes -o</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">jsonpath</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;{.items[0].status.addresses}&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;address&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;10.0.12.185&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;InternalIP&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;address&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;ip-10-0-12-185.ec2.internal&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;InternalDNS&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">,</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;address&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;ip-10-0-12-185.ec2.internal&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;Hostname&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="eof-error-when-starting">EOF Error When Starting<a href="#eof-error-when-starting" class="hash-link" aria-label="Direct link to EOF Error When Starting" title="Direct link to EOF Error When Starting">​</a></h3><p>The agent uses local files for recovering from crashes or restarts. If this backup file becomes corrupted, most commonly due to <a href="/kubernetes_agent#resource-usage">OOMKill</a>, the most straightforward approach to get the agent running again is to perform a fresh install or remove the <code>PersistentVolumeClaim</code>, <code>PersistentVolume</code>, and <code>Pod</code>.</p><p>An example error log line might look like:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;time&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;2023-12-01T00:00:00.000000000Z&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;level&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;ERROR&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;msg&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;failed to setup data store&quot;</span><span class="token plain">,</span><span class="token string" style="color:#e3116c">&quot;err&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;unexpected EOF&quot;</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To uninstall the agent via <code>helm</code>, run:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm uninstall vka -n vantage</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, follow the original installation steps outlined in the above sections.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="optional-use-s3-for-data-persistence">(Optional) Use S3 for Data Persistence<a href="#optional-use-s3-for-data-persistence" class="hash-link" aria-label="Direct link to (Optional) Use S3 for Data Persistence" title="Direct link to (Optional) Use S3 for Data Persistence">​</a></h2><p>The agent requires a persistent store for periodic backups of time-series data as well as checkpointing for periodic reporting. The default deployment option uses a Persistent Volume and works for clusters ranging from tens to thousands of nodes; however, if Persistent Volumes are not supported with your cluster, an alternative configuration, using S3, is available for agents deployed in AWS. If you require persistence to a different object store, you can contact <a href="mailto:support@vantage.sh" target="_blank" rel="noopener noreferrer">support@vantage.sh</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-agent-for-s3-persistence">Configure Agent for S3 Persistence<a href="#configure-agent-for-s3-persistence" class="hash-link" aria-label="Direct link to Configure Agent for S3 Persistence" title="Direct link to Configure Agent for S3 Persistence">​</a></h3><p>The agent uses <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html" target="_blank" rel="noopener noreferrer">IAM roles for service accounts</a> to access the configured bucket. The default <code>vantage</code> namespace and <code>vka-vantage-kubernetes-agent</code> service account names may vary based on your configuration.</p><p>Below are the expected associated permissions for the IAM role:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2012-10-17&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Statement&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;Effect&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Allow&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;Action&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:GetObject&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:PutObject&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:ListBucket&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:AbortMultipartUpload&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:ListMultipartUploadParts&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;s3:DeleteObject&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;Resource&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;arn:aws:s3:::example-bucket-name/*&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token string" style="color:#e3116c">&quot;arn:aws:s3:::example-bucket-name&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the permissions are available, the agent can be configured to start with S3 persistence via the environment variable <code>VANTAGE_PERSIST_S3_BUCKET</code> or, if using the Helm chart, via the <code>--set persist=null --set persist_s3=example-bucket-name</code> values.</p><p>The agent will write persisted data to the <code>$CLUSTER_ID/</code> prefix within the bucket. Multiple agents can use the same bucket as long as they do not have overlapping <code>CLUSTER_ID</code> values. An optional prefix can be prepended with <code>VANTAGE_PERSIST_S3_PREFIX</code> resulting in <code>$VANTAGE_PERSIST_S3_PREFIX/$CLUSTER_ID/</code> being the prefix used by the agent for all objects uploaded.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="migrate-costs-from-opencost-to-vantage-kubernetes-agent">Migrate Costs from OpenCost to Vantage Kubernetes Agent<a href="#migrate-costs-from-opencost-to-vantage-kubernetes-agent" class="hash-link" aria-label="Direct link to Migrate Costs from OpenCost to Vantage Kubernetes Agent" title="Direct link to Migrate Costs from OpenCost to Vantage Kubernetes Agent">​</a></h2><p>If you are moving from an OpenCost integration to the agent-based integration, you can contact <a href="mailto:support@vantage.sh" target="_blank" rel="noopener noreferrer">support@vantage.sh</a> to have your previous integration data maintained. Any overlapping data will be removed from the agent data by the Vantage team.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="maintaining-opencost-filters">Maintaining OpenCost Filters<a href="#maintaining-opencost-filters" class="hash-link" aria-label="Direct link to Maintaining OpenCost Filters" title="Direct link to Maintaining OpenCost Filters">​</a></h3><p>If you previously used the OpenCost integration and are transitioning to the new agent-based integration, your existing filters will be retained. It&#x27;s important to note that in situations where labels contained characters excluded from Prometheus labels, such as <code>-</code>, the OpenCost integration received the normalized versions of those labels from Prometheus. The Vantage Kubernetes agent, on the other hand, directly retrieves labels from the <code>kube-apiserver</code>, resulting in more precise data. However, this change may necessitate updates to filters that previously relied on the normalized values. You can contact <a href="mailto:support@vantage.sh" target="_blank" rel="noopener noreferrer">support@vantage.sh</a> to have these filters converted for you.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/vantage-sh/docs.vantage.sh/blob/master/docs/kubernetes_agent.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/connecting_kubernetes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Kubernetes</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/opencost"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kubernetes (OpenCost)</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#agent-functionality" class="table-of-contents__link toc-highlight">Agent Functionality</a></li><li><a href="#service-compatibility" class="table-of-contents__link toc-highlight">Service Compatibility</a></li><li><a href="#install-vantage-kubernetes-agent" class="table-of-contents__link toc-highlight">Install Vantage Kubernetes Agent</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li></ul></li><li><a href="#create-a-connection" class="table-of-contents__link toc-highlight">Create a Connection</a><ul><li><a href="#enable-annotations-namespace-labels" class="table-of-contents__link toc-highlight">(Optional) Enable Collection of Annotations and Namespace Labels</a></li><li><a href="#resource-usage" class="table-of-contents__link toc-highlight">Resource Usage</a></li><li><a href="#validate-installation" class="table-of-contents__link toc-highlight">Validate Installation</a></li></ul></li><li><a href="#common-errors" class="table-of-contents__link toc-highlight">Common Errors</a><ul><li><a href="#dns-lookup-error" class="table-of-contents__link toc-highlight">DNS Lookup Error</a></li><li><a href="#eof-error-when-starting" class="table-of-contents__link toc-highlight">EOF Error When Starting</a></li></ul></li><li><a href="#optional-use-s3-for-data-persistence" class="table-of-contents__link toc-highlight">(Optional) Use S3 for Data Persistence</a><ul><li><a href="#configure-agent-for-s3-persistence" class="table-of-contents__link toc-highlight">Configure Agent for S3 Persistence</a></li></ul></li><li><a href="#migrate-costs-from-opencost-to-vantage-kubernetes-agent" class="table-of-contents__link toc-highlight">Migrate Costs from OpenCost to Vantage Kubernetes Agent</a><ul><li><a href="#maintaining-opencost-filters" class="table-of-contents__link toc-highlight">Maintaining OpenCost Filters</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/getting_started">Integrations Quickstart</a></li><li class="footer__item"><a class="footer__link-item" href="/cost_reports">Cost Reports</a></li><li class="footer__item"><a class="footer__link-item" href="/autopilot">Autopilot</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://vantage.sh/slack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://handbook.vantage.sh/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cloud Costs Handbook</a></li><li class="footer__item"><a href="https://instances.vantage.sh/" target="_blank" rel="noopener noreferrer" class="footer__link-item">AWS Instances Pricing</a></li><li class="footer__item"><a href="https://instances.vantage.sh/azure" target="_blank" rel="noopener noreferrer" class="footer__link-item">Azure VM Pricing Comparison</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://vantage.readme.io/reference/general" target="_blank" rel="noopener noreferrer" class="footer__link-item">API Documentation</a></li><li class="footer__item"><a href="https://vantage.sh/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vantage Blog</a></li><li class="footer__item"><a href="https://github.com/vantage-sh" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a href="https://status.vantage.sh/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Vantage Status</a></li></ul></div><div class="col footer__col"><div class="footer__title">Company</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.vantage.sh/about/" target="_blank" rel="noopener noreferrer" class="footer__link-item">About</a></li><li class="footer__item"><a href="https://www.vantage.sh/privacy-policy" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Policy</a></li><li class="footer__item"><a href="https://www.vantage.sh/website-terms-of-use" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website Terms of Use</a></li><li class="footer__item"><a href="https://www.vantage.sh/service-agreement" target="_blank" rel="noopener noreferrer" class="footer__link-item">VNTG Service Agreement</a></li><li class="footer__item"><a href="https://www.vantage.sh/subprocessors" target="_blank" rel="noopener noreferrer" class="footer__link-item">Authorized Sub-Processors</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 VNTG, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.96835d8b.js"></script>
<script src="/assets/js/main.5c46ef5e.js"></script>
</body>
</html>